<!DOCTYPE html>
<html>
<section class="pb-5 header text-center">
    <div class="container py-5 text-white">
        <header class="py-5">
            <p class="font-italic mb-1">Use bootstrap button variants to create call to action buttons inside a table, that's just for design, I'm sure you can make them work.</p>
        </header>
        <div class="row">
            <div class="col-lg-7 mx-auto">
                <div class="card border-0 shadow">
                    <div class="card-body p-5">

                        <!-- Responsive table -->
                        <div class="table-responsive">
                            <table class="table m-0">
                                <thead>
                                    <tr>
                                        <th scope="col">Title</th>
                                        <th scope="col">Price</th>
                                        <th scope="col">Author</th>
                                        <th scope="col">Cover Type</th>
                                        <th scope="col">Description</th>
                                        <th scope="col">Artist</th>
                                        <th scope="col">Weight</th>
                                        <th scope="col"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="item : ${itemsToDelete}">
                                        <td th:text="${item.name}"></td>
                                        <td th:text="${item.price}"></td>
                                        <td th:text="${item.author}"></td> 
                                        <td th:text="${item.cover}"></td>
                                        <td th:text="${item.description}"></td>
                                        <td th:text="${item.artist}"></td>
                                        <td th:text="${item.weight}"></td>
                                        <td><button class="delete-button" th:data-id="${item.ID}">Delete</button></td>
                                            <!-- Call to action buttons -->
                                        </td>
                                    </tr>
                                    <div id="loadstuffhere"></div>
                                </table>
                                <script type="text/javascript">
                                    // Gets all the buttons in the DOM
                                    var listOfDeleteButtons = document.getElementsByClassName("delete-button");
                        
                                    // For each button, attach a click handler
                                    for(let buttonIndex = 0; buttonIndex < listOfDeleteButtons.length; buttonIndex++) {
                                        listOfDeleteButtons[buttonIndex].onclick = function() {
                                            // Creates an object to send request to web server
                                            var xhr = new XMLHttpRequest();
                                                xhr.buttonholder = this;
                                            // Define the request method and url
                                            xhr.open("DELETE", "http://localhost/comicbook/deleteform/" + this.dataset.id);
                        
                                            // Set header
                                            xhr.setRequestHeader("Accept", "application/json");
                        
                                            // Set a function to run on state state change
                                            xhr.onreadystatechange = function () {
                                                // state == 4
                                                if (xhr.readyState === 4) {
                                                    xhr.buttonholder.parentElement.parentElement.remove();
                                                    // Log out the status and response to the console
                                                    console.log(xhr.status);
                                                    console.log(xhr.responseText);
                                                    // inject the response text into the html tag with id "loadstuffhere"
                                                    document.getElementById("loadstuffhere").innerHTML = xhr.responseText;
                                                }
                                            };
                        
                                            // Send the request
                                            xhr.send();
                                        }
                                    }
                                </script>
                                </tbody>
                            </table>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
</html>
